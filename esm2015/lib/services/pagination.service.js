import { Injectable } from '@angular/core';
import { PaginationContainer } from '../models/pagination-container.model';
import { DatatransferStore } from '../stores/datatransfer.store';
import * as i0 from "@angular/core";
import * as i1 from "../stores/datatransfer.store";
export class PaginationService {
    constructor(datatransferStore) {
        this.datatransferStore = datatransferStore;
        this.paginatedItems = [];
        this.pagination = new PaginationContainer();
    }
    setRppOptions(rppOptions) {
        this.pagination.rppOptions = rppOptions;
        this.setPaginationContainer();
    }
    update(total) {
        if (total <= 0) {
            this.paginatedItems.length = 0;
        }
        this.pagination.total = total;
        this.setPaginationContainer();
    }
    setPaginationContainer() {
        const pageCount = this.pageCount();
        if (this.pagination.pages.length > pageCount) {
            this.pagination.pages.splice(pageCount);
        }
        else {
            for (let i = this.pagination.pages.length; i < pageCount; i++) {
                this.pagination.pages.push(i + 1);
            }
        }
        if (!this.pagination.pages.includes(this.pagination.page)) {
            this.pagination.page = 1;
        }
        if (!!this.pagination.rppOptions && this.pagination.rppOptions.length > 0
            && !this.pagination.rppOptions.includes(this.pagination.rpp)) {
            this.pagination.rpp = this.pagination.rppOptions[0];
        }
        this.onPaginationChange();
    }
    max() {
        return this.hasNext() ? this.pagination.page * this.pagination.rpp : this.pagination.total;
    }
    min() {
        return this.pagination.total > 0 ? this.pagination.page * this.pagination.rpp - this.pagination.rpp + 1 : 0;
    }
    first() {
        this.pagination.page = 1;
        this.onPaginationChange();
    }
    last() {
        this.pagination.page = this.pageCount();
        this.onPaginationChange();
    }
    hasNext() {
        return this.pagination.page * this.pagination.rpp < this.pagination.total;
    }
    hasPrevious() {
        return this.pagination.page > 1;
    }
    moveNext() {
        this.pagination.page++;
        this.onPaginationChange();
    }
    movePrevious() {
        this.pagination.page--;
        this.onPaginationChange();
    }
    setPage(page) {
        this.pagination.page = page;
        this.onPageChange();
    }
    onPageChange() {
        this.setPaginationContainer();
        this.onPaginationChange();
    }
    onRppChange() {
        this.setPaginationContainer();
        this.pagination.page = 1;
        this.onPaginationChange();
    }
    onPaginationChange() {
        const startIndex = (this.pagination.page - 1) * this.pagination.rpp;
        const endIndex = Math.min(startIndex + this.pagination.rpp, this.pagination.total);
        this.paginatedItems = this.datatransferStore.getItems().slice(startIndex, endIndex);
    }
    pageCount() {
        return this.pagination.total > 0 ? Math.ceil(this.pagination.total / (this.pagination.rpp > 0 ? this.pagination.rpp : 1)) : 1;
    }
    getPageByItemId(id) {
        const index = this.datatransferStore.getIndexById(id);
        if (index > -1) {
            return Math.ceil((index + 1) / this.pagination.rpp);
        }
    }
    setPageByItemId(id) {
        const page = this.getPageByItemId(id);
        if (this.pagination.page !== page) {
            this.setPage(page);
        }
    }
}
PaginationService.ɵfac = function PaginationService_Factory(t) { return new (t || PaginationService)(i0.ɵɵinject(i1.DatatransferStore)); };
PaginationService.ɵprov = i0.ɵɵdefineInjectable({ token: PaginationService, factory: PaginationService.ɵfac });
(function () { (typeof ngDevMode === "undefined" || ngDevMode) && i0.ɵsetClassMetadata(PaginationService, [{
        type: Injectable
    }], function () { return [{ type: i1.DatatransferStore }]; }, null); })();
//# sourceMappingURL=data:application/json;base64,eyJ2ZXJzaW9uIjozLCJmaWxlIjoicGFnaW5hdGlvbi5zZXJ2aWNlLmpzIiwic291cmNlUm9vdCI6IiIsInNvdXJjZXMiOlsiLi4vLi4vLi4vLi4vLi4vcHJvamVjdHMvYW1kLWxpYi9zcmMvbGliL3NlcnZpY2VzL3BhZ2luYXRpb24uc2VydmljZS50cyJdLCJuYW1lcyI6W10sIm1hcHBpbmdzIjoiQUFBQSxPQUFPLEVBQUUsVUFBVSxFQUFFLE1BQU0sZUFBZSxDQUFDO0FBQzNDLE9BQU8sRUFBd0IsbUJBQW1CLEVBQUUsTUFBTSxzQ0FBc0MsQ0FBQztBQUVqRyxPQUFPLEVBQUUsaUJBQWlCLEVBQUUsTUFBTSw4QkFBOEIsQ0FBQzs7O0FBR2pFLE1BQU0sT0FBTyxpQkFBaUI7SUFLMUIsWUFBb0IsaUJBQW9DO1FBQXBDLHNCQUFpQixHQUFqQixpQkFBaUIsQ0FBbUI7UUFGakQsbUJBQWMsR0FBd0IsRUFBRSxDQUFDO1FBRzVDLElBQUksQ0FBQyxVQUFVLEdBQUcsSUFBSSxtQkFBbUIsRUFBRSxDQUFDO0lBQ2hELENBQUM7SUFFRCxhQUFhLENBQUMsVUFBb0I7UUFDOUIsSUFBSSxDQUFDLFVBQVUsQ0FBQyxVQUFVLEdBQUcsVUFBVSxDQUFDO1FBQ3hDLElBQUksQ0FBQyxzQkFBc0IsRUFBRSxDQUFDO0lBQ2xDLENBQUM7SUFFRCxNQUFNLENBQUMsS0FBYTtRQUNoQixJQUFJLEtBQUssSUFBSSxDQUFDLEVBQUU7WUFDWixJQUFJLENBQUMsY0FBYyxDQUFDLE1BQU0sR0FBRyxDQUFDLENBQUM7U0FDbEM7UUFDRCxJQUFJLENBQUMsVUFBVSxDQUFDLEtBQUssR0FBRyxLQUFLLENBQUM7UUFDOUIsSUFBSSxDQUFDLHNCQUFzQixFQUFFLENBQUM7SUFDbEMsQ0FBQztJQUVELHNCQUFzQjtRQUNsQixNQUFNLFNBQVMsR0FBVyxJQUFJLENBQUMsU0FBUyxFQUFFLENBQUM7UUFDM0MsSUFBSSxJQUFJLENBQUMsVUFBVSxDQUFDLEtBQUssQ0FBQyxNQUFNLEdBQUcsU0FBUyxFQUFFO1lBQzFDLElBQUksQ0FBQyxV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QUFFO1lBQ1osT0FBTyxJQUFJLENBQUMsSUFBSSxDQUFDLENBQUMsS0FBSyxHQUFHLENBQUMsQ0FBQyxHQUFHLElBQUksQ0FBQyxVQUFVLENBQUMsR0FBRyxDQUFDLENBQUM7U0FDdkQ7SUFDTCxDQUFDO0lBRUQsZUFBZSxDQUFDLEVBQVU7UUFDdEIsTUFBTSxJQUFJLEdBQUcsSUFBSSxDQUFDLGVBQWUsQ0FBQyxFQUFFLENBQUMsQ0FBQztRQUN0QyxJQUFJLElBQUksQ0FBQyxVQUFVLENBQUMsSUFBSSxLQUFLLElBQUksRUFBRTtZQUMvQixJQUFJLENBQUMsT0FBTyxDQUFDLElBQUksQ0FBQyxDQUFDO1NBQ3RCO0lBQ0wsQ0FBQzs7a0ZBbkhRLGlCQUFpQjt5REFBakIsaUJBQWlCLFdBQWpCLGlCQUFpQjt1RkFBakIsaUJBQWlCO2NBRDdCLFVBQVUiLCJzb3VyY2VzQ29udGVudCI6WyJpbXBvcnQgeyBJbmplY3RhYmxlIH0gZnJvbSAnQGFuZ3VsYXIvY29yZSc7XHJcbmltcG9ydCB7IElQYWdpbmF0aW9uQ29udGFpbmVyLCBQYWdpbmF0aW9uQ29udGFpbmVyIH0gZnJvbSAnLi4vbW9kZWxzL3BhZ2luYXRpb24tY29udGFpbmVyLm1vZGVsJztcclxuaW1wb3J0IHsgSURhdGF0cmFuc2Zlckl0ZW0gfSBmcm9tICcuLi9tb2RlbHMvZGF0YXRyYW5zZmVyLWl0ZW0ubW9kZWwnO1xyXG5pbXBvcnQgeyBEYXRhdHJhbnNmZXJTdG9yZSB9IGZyb20gJy4uL3N0b3Jlcy9kYXRhdHJhbnNmZXIuc3RvcmUnO1xyXG5cclxuQEluamVjdGFibGUoKVxyXG5leHBvcnQgY2xhc3MgUGFnaW5hdGlvblNlcnZpY2Uge1xyXG5cclxuICAgIHB1YmxpYyBwYWdpbmF0aW9uOiBJUGFnaW5hdGlvbkNvbnRhaW5lcjtcclxuICAgIHB1YmxpYyBwYWdpbmF0ZWRJdGVtczogSURhdGF0cmFuc2Zlckl0ZW1bXSA9IFtdO1xyXG5cclxuICAgIGNvbnN0cnVjdG9yKHByaXZhdGUgZGF0YXRyYW5zZmVyU3RvcmU6IERhdGF0cmFuc2ZlclN0b3JlKSB7XHJcbiAgICAgICAgdGhpcy5wYWdpbmF0aW9uID0gbmV3IFBhZ2luYXRpb25Db250YWluZXIoKTtcclxuICAgIH1cclxuXHJcbiAgICBzZXRScHBPcHRpb25zKHJwcE9wdGlvbnM6IG51bWJlcltdKTogdm9pZCB7XHJcbiAgICAgICAgdGhpcy5wYWdpbmF0aW9uLnJwcE9wdGlvbnMgPSBycHBPcHRpb25zO1xyXG4gICAgICAgIHRoaXMuc2V0UGFnaW5hdGlvbkNvbnRhaW5lcigpO1xyXG4gICAgfVxyXG5cclxuICAgIHVwZGF0ZSh0b3RhbDogbnVtYmVyKTogdm9pZCB7XHJcbiAgICAgICAgaWYgKHRvdGFsIDw9IDApIHtcclxuICAgICAgICAgICAgdGhpcy5wYWdpbmF0ZWRJdGVtcy5sZW5ndGggPSAwO1xyXG4gICAgICAgIH1cclxuICAgICAgICB0aGlzLnBhZ2luYXRpb24udG90YWwgPSB0b3RhbDtcclxuICAgICAgICB0aGlzLnNldFBhZ2luYXRpb25Db250YWluZXIoKTtcclxuICAgIH1cclxuXHJcbiAgICBzZXRQYWdpbmF0aW9uQ29udGFpbmVyKCk6IHZvaWQge1xyXG4gICAgICAgIGNvbnN0IHBhZ2VDb3VudDogbnVtYmVyID0gdGhpcy5wYWdlQ291bnQoKTtcclxuICAgICAgICBpZiAodGhpcy5wYWdpbmF0aW9uLnBhZ2VzLmxlbmd0aCA+IHBhZ2VDb3VudCkge1xyXG4gICAgICAgICAgICB0aGlzLnBhZ2luYXRpb24ucGFnZXMuc3BsaWNlKHBhZ2VDb3VudCk7XHJcbiAgICAgICAgfSBlbHNlIHtcclxuICAgICAgICAgICAgZm9yIChsZXQgaSA9IHRoaXMucGFnaW5hdGlvbi5wYWdlcy5sZW5ndGg7IGkgPCBwYWdlQ291bnQ7IGkrKykge1xyXG4gICAgICAgICAgICAgICAgdGhpcy5wYWdpbmF0aW9uLnBhZ2VzLnB1c2goaSArIDEpO1xyXG4gICAgICAgICAgICB9XHJcbiAgICAgICAgfVxyXG4gICAgICAgIGlmICghdGhpcy5wYWdpbmF0aW9uLnBhZ2VzLmluY2x1ZGVzKHRoaXMucGFnaW5hdGlvbi5wYWdlKSkge1xyXG4gICAgICAgICAgICB0aGlzLnBhZ2luYXRpb24ucGFnZSA9IDE7XHJcbiAgICAgICAgfVxyXG4gICAgICAgIGlmICghIXRoaXMucGFnaW5hdGlvbi5ycHBPcHRpb25zICYmIHRoaXMucGFnaW5hdGlvbi5ycHBPcHRpb25zLmxlbmd0aCA+IDBcclxuICAgICAgICAgICAgJiYgIXRoaXMucGFnaW5hdGlvbi5ycHBPcHRpb25zLmluY2x1ZGVzKHRoaXMucGFnaW5hdGlvbi5ycHApKSB7XHJcbiAgICAgICAgICAgIHRoaXMucGFnaW5hdGlvbi5ycHAgPSB0aGlzLnBhZ2luYXRpb24ucnBwT3B0aW9uc1swXTtcclxuICAgICAgICB9XHJcbiAgICAgICAgdGhpcy5vblBhZ2luYXRpb25DaGFuZ2UoKTtcclxuICAgIH1cclxuXHJcbiAgICBtYXgoKTogbnVtYmVyIHtcclxuICAgICAgICByZXR1cm4gdGhpcy5oYXNOZXh0KCkgPyB0aGlzLnBhZ2luYXRpb24ucGFnZSAqIHRoaXMucGFnaW5hdGlvbi5ycHAgOiB0aGlzLnBhZ2luYXRpb24udG90YWw7XHJcbiAgICB9XHJcblxyXG4gICAgbWluKCk6IG51bWJlciB7XHJcbiAgICAgICAgcmV0dXJuIHRoaXMucGFnaW5hdGlvbi50b3RhbCA+IDAgPyB0aGlzLnBhZ2luYXRpb24ucGFnZSAqIHRoaXMucGFnaW5hdGlvbi5ycHAgLSB0aGlzLnBhZ2luYXRpb24ucnBwICsgMSA6IDA7XHJcbiAgICB9XHJcblxyXG4gICAgZmlyc3QoKTogdm9pZCB7XHJcbiAgICAgICAgdGhpcy5wYWdpbmF0aW9uLnBhZ2UgPSAxO1xyXG4gICAgICAgIHRoaXMub25QYWdpbmF0aW9uQ2hhbmdlKCk7XHJcbiAgICB9XHJcblxyXG4gICAgbGFzdCgpOiB2b2lkIHtcclxuICAgICAgICB0aGlzLnBhZ2luYXRpb24ucGFnZSA9IHRoaXMucGFnZUNvdW50KCk7XHJcbiAgICAgICAgdGhpcy5vblBhZ2luYXRpb25DaGFuZ2UoKTtcclxuICAgIH1cclxuXHJcbiAgICBoYXNOZXh0KCk6IGJvb2xlYW4ge1xyXG4gICAgICAgIHJldHVybiB0aGlzLnBhZ2luYXRpb24ucGFnZSAqIHRoaXMucGFnaW5hdGlvbi5ycHAgPCB0aGlzLnBhZ2luYXRpb24udG90YWw7XHJcbiAgICB9XHJcblxyXG4gICAgaGFzUHJldmlvdXMoKTogYm9vbGVhbiB7XHJcbiAgICAgICAgcmV0dXJuIHRoaXMucGFnaW5hdGlvbi5wYWdlID4gMTtcclxuICAgIH1cclxuXHJcbiAgICBtb3ZlTmV4dCgpOiB2b2lkIHtcclxuICAgICAgICB0aGlzLnBhZ2luYXRpb24ucGFnZSsrO1xyXG4gICAgICAgIHRoaXMub25QYWdpbmF0aW9uQ2hhbmdlKCk7XHJcbiAgICB9XHJcblxyXG4gICAgbW92ZVByZXZpb3VzKCk6IHZvaWQge1xyXG4gICAgICAgIHRoaXMucGFnaW5hdGlvbi5wYWdlLS07XHJcbiAgICAgICAgdGhpcy5vblBhZ2luYXRpb25DaGFuZ2UoKTtcclxuICAgIH1cclxuXHJcbiAgICBzZXRQYWdlKHBhZ2U6IG51bWJlcikge1xyXG4gICAgICAgIHRoaXMucGFnaW5hdGlvbi5wYWdlID0gcGFnZTtcclxuICAgICAgICB0aGlzLm9uUGFnZUNoYW5nZSgpO1xyXG4gICAgfVxyXG5cclxuICAgIG9uUGFnZUNoYW5nZSgpOiB2b2lkIHtcclxuICAgICAgICB0aGlzLnNldFBhZ2luYXRpb25Db250YWluZXIoKTtcclxuICAgICAgICB0aGlzLm9uUGFnaW5hdGlvbkNoYW5nZSgpO1xyXG4gICAgfVxyXG5cclxuICAgIG9uUnBwQ2hhbmdlKCk6IHZvaWQge1xyXG4gICAgICAgIHRoaXMuc2V0UGFnaW5hdGlvbkNvbnRhaW5lcigpO1xyXG4gICAgICAgIHRoaXMucGFnaW5hdGlvbi5wYWdlID0gMTtcclxuICAgICAgICB0aGlzLm9uUGFnaW5hdGlvbkNoYW5nZSgpO1xyXG4gICAgfVxyXG5cclxuICAgIG9uUGFnaW5hdGlvbkNoYW5nZSgpOiB2b2lkIHtcclxuICAgICAgICBjb25zdCBzdGFydEluZGV4ID0gKHRoaXMucGFnaW5hdGlvbi5wYWdlIC0gMSkgKiB0aGlzLnBhZ2luYXRpb24ucnBwO1xyXG4gICAgICAgIGNvbnN0IGVuZEluZGV4ID0gTWF0aC5taW4oc3RhcnRJbmRleCArIHRoaXMucGFnaW5hdGlvbi5ycHAsIHRoaXMucGFnaW5hdGlvbi50b3RhbCk7XHJcbiAgICAgICAgdGhpcy5wYWdpbmF0ZWRJdGVtcyA9IHRoaXMuZGF0YXRyYW5zZmVyU3RvcmUuZ2V0SXRlbXMoKS5zbGljZShzdGFydEluZGV4LCBlbmRJbmRleCk7XHJcbiAgICB9XHJcblxyXG4gICAgcGFnZUNvdW50KCk6IG51bWJlciB7XHJcbiAgICAgICAgcmV0dXJuIHRoaXMucGFnaW5hdGlvbi50b3RhbCA+IDAgPyBNYXRoLmNlaWwodGhpcy5wYWdpbmF0aW9uLnRvdGFsIC8gKHRoaXMucGFnaW5hdGlvbi5ycHAgPiAwID8gdGhpcy5wYWdpbmF0aW9uLnJwcCA6IDEpKSA6IDE7XHJcbiAgICB9XHJcblxyXG4gICAgZ2V0UGFnZUJ5SXRlbUlkKGlkOiBzdHJpbmcpOiBudW1iZXIge1xyXG4gICAgICAgIGNvbnN0IGluZGV4OiBudW1iZXIgPSB0aGlzLmRhdGF0cmFuc2ZlclN0b3JlLmdldEluZGV4QnlJZChpZCk7XHJcbiAgICAgICAgaWYgKGluZGV4ID4gLTEpIHtcclxuICAgICAgICAgICAgcmV0dXJuIE1hdGguY2VpbCgoaW5kZXggKyAxKSAvIHRoaXMucGFnaW5hdGlvbi5ycHApO1xyXG4gICAgICAgIH1cclxuICAgIH1cclxuXHJcbiAgICBzZXRQYWdlQnlJdGVtSWQoaWQ6IHN0cmluZyk6IHZvaWQge1xyXG4gICAgICAgIGNvbnN0IHBhZ2UgPSB0aGlzLmdldFBhZ2VCeUl0ZW1JZChpZCk7XHJcbiAgICAgICAgaWYgKHRoaXMucGFnaW5hdGlvbi5wYWdlICE9PSBwYWdlKSB7XHJcbiAgICAgICAgICAgIHRoaXMuc2V0UGFnZShwYWdlKTtcclxuICAgICAgICB9XHJcbiAgICB9XHJcbn1cclxuIl19